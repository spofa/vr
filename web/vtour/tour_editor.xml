<krpano version="1.19" title="优视全景 - 设置场景" debugmode="true">

    <include url="%SWFPATH%/skin/vtourskin.xml" />

    <!-- 自动旋转 -->
    <autorotate enabled="true"
                waittime="3.0"
                speed="3.0"
                horizon="0.0"
                tofov="120.0"
    />


    <!--
        For an alternative skin design either change the <skin_settings> values
        from above or optionally include one of the predefined designs from below.
    -->
    <!-- <include url="skin/vtourskin_design_flat_light.xml"  /> -->
    <!-- <include url="skin/vtourskin_design_glass.xml"       /> -->
    <!-- <include url="skin/vtourskin_design_ultra_light.xml" /> -->
    <!-- <include url="skin/vtourskin_design_117.xml"         /> -->
    <!-- <include url="skin/vtourskin_design_117round.xml"    /> -->
    <!-- <include url="skin/vtourskin_design_black.xml"       /> -->

    <!-- startup action - load the first scene -->
    <action name="startup" autorun="onstart">
        if(startscene === null OR !scene[get(startscene)], copy(startscene,scene[0].name); );
        loadscene(get(startscene), null, MERGE);
        if(startactions !== null, startactions() );
    </action>



    <!--
        For an alternative skin design either change the <skin_settings> values
        from above or optionally include one of the predefined designs from below.
    -->
    <!-- <include url="skin/vtourskin_design_flat_light.xml"  /> -->
    <!-- <include url="skin/vtourskin_design_glass.xml"       /> -->
    <!-- <include url="skin/vtourskin_design_ultra_light.xml" /> -->
    <!-- <include url="skin/vtourskin_design_117.xml"         /> -->
    <!-- <include url="skin/vtourskin_design_117round.xml"    /> -->
    <!-- <include url="skin/vtourskin_design_black.xml"       /> -->

    <!-- startup action - load the first scene -->
    <action name="startup" autorun="onstart">
        if(startscene === null OR !scene[get(startscene)], copy(startscene,scene[0].name); );
        loadscene(get(startscene), null, MERGE);
        if(startactions !== null, startactions() );
    </action>


    <!-- scene缩略列表弹窗 -->
    <layer name="scene_thumb_container" style="container" width="290" height="240" bgcapture="false" bgalpha="0.7" align="center" visible="false">
        <!-- 标题 -->
        <layer name="scene_thumb_title" style="text" align="top" y="5" width="100%" css="text-align:center;color:#ffffff;font-weight:bold;font-size:14px;" html="为热点设置跳转场景" />
        <!-- the scrolling container -->
        <layer name="scroll_container" type="container" align="topleft" x="0" y="32" width="280" height="172">
            <!-- the scrolling content -->
            <layer name="scroll_content" url="%SWFPATH%/plugins/scrollarea.swf" alturl="%SWFPATH%/plugins/scrollarea.js" mwheel="true" direction="v" overscroll="0" align="lefttop" width="100%" height="112" onscroll="if(hoverflow GT 0, div(yp,toverflow,hoverflow);Math.min(yp,1);Math.max(yp,0); copy(th,layer[scrollbar].pixelheight);sub(th,layer[scrollup].pixelheight);sub(th,layer[scrolldown].pixelheight);sub(th,layer[scrollslider].pixelheight); mul(yp,th);add(yp,layer[scrollup].pixelheight); copy(layer[scrollslider].y,yp); );">



                <layer name="s_185374" style="subbtn" width="240" height="50" y="1" x="10" bgcolor="0x000000" bgborder="1 0xffffff 1" bgalpha="0.5" onclick="select_scene();">
                    <layer name="s_185374_p" type="image" url="http://cdn.useevr.cn/5/201696QYGHMR/thumb.jpg" align="left" width="40" height="40" x="5" />
                    <layer name="s_185374_t" style="text" width="190" align="left" x="50"  css="text-align:center;color:#ffffff;" html="test111"/>
                </layer>
                0

                <layer name="s_196929" style="subbtn" width="240" height="50" y="61" x="10" bgcolor="0x000000" bgborder="1 0xffffff 1" bgalpha="0.5" onclick="select_scene();">
                    <layer name="s_196929_p" type="image" url="http://cdn.useevr.cn/5/201696KRsjNr/thumb.jpg" align="left" width="40" height="40" x="5" />
                    <layer name="s_196929_t" style="text" width="190" align="left" x="50"  css="text-align:center;color:#ffffff;" html="fsad"/>
                </layer>
                1

            </layer>
            <!-- the scrollbar -->
            <layer name="scrollbar" type="container" bgcolor="0x000000" bgalpha="0.25" align="righttop" x="0" y="0" width="19" height="100%">
                <layer name="scrollup"     url="skin/dirbutton.png"    align="righttop"    x="19" rotate="-90" crop="0|0|19|19" onovercrop="0|19|19|19" ondowncrop="0|38|19|19" ondown="asyncloop(pressed, layer[scroll_content].scrollby(0,+1));" />
                <layer name="scrolldown"   url="skin/dirbutton.png"    align="rightbottom" x="19" rotate="+90" crop="0|0|19|19" onovercrop="0|19|19|19" ondowncrop="0|38|19|19" ondown="asyncloop(pressed, layer[scroll_content].scrollby(0,-1));" />
                <layer name="scrollslider" url="skin/sliderbutton.png" align="righttop" x="0" y="19" crop="0|0|19|19" onovercrop="0|19|19|19" ondowncrop="0|38|19|19" ondown="if(layer[scroll_content].hoverflow GT 0, copy(cy,y);copy(sy,mouse.stagey);dragging(); );" dragging="if(pressed, sub(dy,mouse.stagey,sy);add(ny,cy,dy);Math.max(ny,layer[scrollup].pixelheight); copy(th,layer[scrollbar].pixelheight);sub(th,layer[scrolldown].pixelheight);sub(th,layer[scrollslider].pixelheight);Math.min(ny,th); copy(y,ny); sub(ny,layer[scrollup].pixelheight);sub(th,layer[scrollslider].pixelheight);div(ny,th); copy(fh,layer[scroll_content].hoverflow); mul(fh,-1); mul(ny,fh); layer[scroll_content].stopscrolling(); copy(layer[scroll_content].y,ny); delayedcall(0,dragging()); );" />
            </layer>
        </layer>

        <!-- 按钮 -->
        <layer name="btn_con_link_container" style="subbtn" width="130" auheight="true" align="topleft" x="10" y="210" enabled="false" onclick="confirm_linkded_scene();">
            <layer name="btn_con_link_scene" style="text" html="确定" />
        </layer>
        <layer name="btn_can_link_scene_p" style="subbtn" width="130" align="topright" x="10" y="210" onclick="cancel_add_hotspot();">
            <layer name="btn_can_link_scene" style="text" html="取消" />
        </layer>
    </layer>

    <include url="%SWFPATH%/skin/vtoureditor.xml" />

    <!--    <{foreach $pro.scenes as $k=>$v}>-->
    <?php foreach($xml as $k=>$v):?>
    <scene name="<?= $k;?>" title="<?=$v['view']['title']?>">

        <!--     <{if $pro.radars neq "" }> onstart="activatespot(<{$pro.radars[$k].rotate}>)" <{/if}>-->
        <!--     thumburl="<{$v.img}>thumb.jpg" lat="" lng="" heading="">-->

        <!--    <{if $pro.bd && $pro.logo}>-->
        <!-- the floor platform -->
        <!--    <hotspot zorder="1" distorted="true" enabled="false"-->
        <!--             url="<{$_lang.img_host}><{$pro.uid}>/logo.png" width="250" height="250" alpha="1"-->
        <!--             rx="-90" ty="5000" scale="5"-->
        <!--            />-->
        <!--    <{/if}>-->

        <view hlookat="<?php echo ($v['view']['hlookat'])?$v['view']['hlookat']:0;  ?>" vlookat="<?php echo ($v['view']['vlookat'])?$v['view']['vlookat']:0;  ?>"
              fovtype="MFOV" fov="120" maxpixelzoom="2.0" fovmin="70" fovmax="140" limitview="auto" />

        <!--    <preview url="<{$v.img}>preview.jpg" />-->
        <!--    <image>-->
        <!--        <cube url="<{$v.img}>pano_%s.jpg" />-->
        <!--        <cube url="<{$v.img}>mobile/pano_%s.jpg" devices="mobile" />-->
        <!--    </image>-->

        <preview url="vtour/panos/<?=$v['view']['title']?>.tiles/preview.jpg" />

        <image type="CUBE" multires="true" tilesize="512" if="!webvr.isenabled">
            <level tiledimagewidth="128" tiledimageheight="128">
                <cube url="vtour/panos/<?=$v['view']['title']?>.tiles/%s/l1/%v/l1_%s_%v_%h.jpg" />
            </level>
        </image>

        <image if="webvr.isenabled">
            <cube url="vtour/panos/<?=$v['view']['title']?>.tiles/vr/pano_%s.jpg" />
        </image>

        <?php if($v['hotspots'] && is_array($v['hotspots']) && count($v['hotspots'])):    ?>
        <?php foreach($v['hotspots'] as $k2 => $v2): ?>
        <hotspot name="<?= $v2['hname'];?>" style="skin_hotspotstyle" distorted="true" depth="10000" scale="6" zoom="false" ath="<?= $v2['ath'];?>" atv="<?=$v2['hname'];?>" rotate="<?=intval($v2['rotate']);?>" linkedscene="<?=$v2['linkedscene'];?>" />
        <?php endforeach; ?>
        <?php endif; ?>


        <!--    <{foreach $v.picspots as $v3}>-->
        <!--    <hotspot name="<{$v3.hname}>" url="<{$v3.url}>" distorted="true" depth="<{$v3.depth}>" scale="<{$v3.scale}>" ath="<{$v3.ath}>" atv="<{$v3.atv}>" rotate="<{intval($v3.rotate)}>"/>-->
        <!--    <{/foreach}>-->

    </scene>
    <?php endforeach;?>

</krpano>